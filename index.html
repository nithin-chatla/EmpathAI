<!DOCTYPE html>
<html lang="en">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
Â  Â  <title>Empath AI - AI Medical Consultant</title>
Â  Â  
Â  Â  <!-- Tailwind CSS -->
Â  Â  <script src="https://cdn.tailwindcss.com"></script>
Â  Â  
Â  Â  <!-- Lucide Icons -->
Â  Â  <script src="https://unpkg.com/lucide@latest"></script>
Â  Â  
Â  Â  <!-- Google Fonts -->
Â  Â  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

Â  Â  <style>
Â  Â  Â  Â  body {
Â  Â  Â  Â  Â  Â  font-family: 'Inter', sans-serif;
Â  Â  Â  Â  Â  Â  /* fixed inset-0 locks the body to the viewport on mobile to prevent scroll issues */
Â  Â  Â  Â  Â  Â  position: fixed; 
Â  Â  Â  Â  Â  Â  inset: 0;
Â  Â  Â  Â  Â  Â  height: 100dvh; 
Â  Â  Â  Â  Â  Â  width: 100vw;
Â  Â  Â  Â  Â  Â  overflow: hidden;
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  /* Safe area padding for modern mobile devices (Notch/Home Bar) */
Â  Â  Â  Â  .safe-bottom {
Â  Â  Â  Â  Â  Â  padding-bottom: env(safe-area-inset-bottom);
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  .pt-safe-top {
Â  Â  Â  Â  Â  Â  padding-top: env(safe-area-inset-top);
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  /* Animations */
Â  Â  Â  Â  @keyframes fadeInUp {
Â  Â  Â  Â  Â  Â  from {
Â  Â  Â  Â  Â  Â  Â  Â  opacity: 0;
Â  Â  Â  Â  Â  Â  Â  Â  transform: translateY(10px);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  to {
Â  Â  Â  Â  Â  Â  Â  Â  opacity: 1;
Â  Â  Â  Â  Â  Â  Â  Â  transform: translateY(0);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  .animate-fade-in-up {
Â  Â  Â  Â  Â  Â  animation: fadeInUp 0.3s ease-out forwards;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* Custom Scrollbar */
Â  Â  Â  Â  .scrollbar-hide::-webkit-scrollbar {
Â  Â  Â  Â  Â  Â  display: none;
Â  Â  Â  Â  }
Â  Â  Â  Â  .scrollbar-hide {
Â  Â  Â  Â  Â  Â  -ms-overflow-style: none;
Â  Â  Â  Â  Â  Â  scrollbar-width: none;
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  /* Typing Bounce Animation */
Â  Â  Â  Â  @keyframes bounce {
Â  Â  Â  Â  Â  Â  0%, 100% { transform: translateY(0); }
Â  Â  Â  Â  Â  Â  50% { transform: translateY(-4px); }
Â  Â  Â  Â  }
Â  Â  Â  Â  .animate-bounce-dot {
Â  Â  Â  Â  Â  Â  animation: bounce 0.6s infinite;
Â  Â  Â  Â  }
Â  Â  </style>
</head>
<!-- Flex-col on mobile, Flex-row on medium screens+ -->
<body class="bg-slate-50 text-slate-800 flex flex-col md:flex-row">

Â  Â  <!-- Mobile Sidebar Overlay -->
Â  Â  <div id="sidebar-overlay" class="fixed inset-0 bg-black/20 z-40 hidden backdrop-blur-sm md:hidden"></div>

Â  Â  <!-- Sidebar -->
Â  Â  <aside id="sidebar" class="fixed md:relative z-50 h-full w-72 bg-white border-r border-slate-200 shadow-2xl md:shadow-none transform -translate-x-full md:translate-x-0 transition-transform duration-300 ease-in-out flex flex-col">
Â  Â  Â  Â  
Â  Â  Â  Â  <!-- Sidebar Header -->
Â  Â  Â  Â  <div class="p-6 border-b border-slate-100 bg-blue-50/50 pt-safe-top md:pt-6">
Â  Â  Â  Â  Â  Â  <div class="flex items-center space-x-3 mb-1">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="p-2 bg-blue-600 rounded-lg">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i data-lucide="stethoscope" class="w-6 h-6 text-white"></i>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <h1 class="text-xl font-bold text-slate-800">Empath AI</h1>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <p class="text-xs text-slate-500 mt-2">AI Medical Consultant</p>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <!-- Sidebar Content -->
Â  Â  Â  Â  <div class="flex-1 overflow-y-auto p-6 space-y-8">
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  <!-- Crisis Card -->
Â  Â  Â  Â  Â  Â  <div class="bg-red-50 border border-red-100 rounded-xl p-4">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-center space-x-2 text-red-700 mb-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i data-lucide="phone" class="w-4 h-4"></i>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="font-semibold text-sm">Emergency?</span>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-xs text-red-600 mb-3">For medical emergencies, do not use this app. Please call the emergency number.</p>
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="window.location.href='tel:108'" class="w-full bg-white border border-red-200 text-red-600 py-2 px-3 rounded-lg text-sm font-medium hover:bg-red-50 transition flex items-center justify-center active:scale-95">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Call 108 (Emergency)
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <!-- Features -->
Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-4">Capabilities</h3>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="space-y-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-start space-x-3">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i data-lucide="shield" class="w-5 h-5 text-blue-600 mt-0.5"></i>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h4 class="text-sm font-medium text-slate-700">Symptom Check</h4>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-xs text-slate-500">Step-by-step analysis.</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-start space-x-3">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i data-lucide="activity" class="w-5 h-5 text-blue-600 mt-0.5"></i>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h4 class="text-sm font-medium text-slate-700">Health Advice</h4>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-xs text-slate-500">Concise medical guidance.</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  <!-- Disclaimer -->
Â  Â  Â  Â  Â  Â  <div class="bg-yellow-50 rounded-xl p-4 mb-safe-bottom">
Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="flex items-start space-x-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i data-lucide="info" class="w-4 h-4 text-yellow-600 mt-0.5 flex-shrink-0"></i>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-xs text-yellow-800 leading-relaxed">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <strong>Disclaimer:</strong> I am an AI. My advice is for informational purposes only. Always consult a real doctor for final diagnosis.
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </p>
Â  Â  Â  Â  Â  Â  Â  Â  Â </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <!-- Close Sidebar Button (Mobile) -->
Â  Â  Â  Â  <button id="close-sidebar" class="md:hidden absolute top-4 right-4 p-3 text-slate-400 hover:text-slate-600 active:bg-slate-100 rounded-full">
Â  Â  Â  Â  Â  Â  <i data-lucide="x" class="w-6 h-6"></i>
Â  Â  Â  Â  </button>
Â  Â  </aside>

Â  Â  <!-- Main Chat Area -->
Â  Â  <main class="flex-1 flex flex-col bg-slate-50 relative min-w-0 h-full">
Â  Â  Â  Â  
Â  Â  Â  Â  <!-- Header -->
Â  Â  Â  Â  <header class="bg-white h-16 border-b border-slate-200 flex items-center justify-between px-4 md:px-8 sticky top-0 z-10 shrink-0">
Â  Â  Â  Â  Â  Â  <div class="flex items-center">
Â  Â  Â  Â  Â  Â  Â  Â  <button id="open-sidebar" class="mr-4 p-2 -ml-2 rounded-lg hover:bg-slate-100 md:hidden text-slate-600 active:bg-slate-200">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i data-lucide="menu" class="w-6 h-6"></i>
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex flex-col">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="font-bold text-slate-800">Medical Consultation</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-xs text-blue-500 flex items-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="w-2 h-2 bg-blue-500 rounded-full mr-1.5"></span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Empath AI Active
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </header>

Â  Â  Â  Â  <!-- Messages Container -->
Â  Â  Â  Â  <div id="chat-messages" class="flex-1 overflow-y-auto p-4 md:p-8 space-y-6 scroll-smooth w-full min-h-0">
Â  Â  Â  Â  Â  Â  <div class="flex justify-center mb-8">
Â  Â  Â  Â  Â  Â  Â  Â  <span class="bg-slate-200/60 text-slate-500 text-xs py-1 px-3 rounded-full">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Today
Â  Â  Â  Â  Â  Â  Â  Â  </span>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <!-- Messages will be injected here by JS -->
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <!-- Input Area -->
Â  Â  Â  Â  <!-- Converted to floating card on mobile (mb-4 mx-2 rounded-2xl) to ensure visibility -->
Â  Â  Â  Â  <!-- Reverts to standard bar on desktop (md:mb-0 md:mx-0 md:rounded-none) -->
Â  Â  Â  Â  <div class="p-4 md:p-6 bg-white border-t border-slate-200 shrink-0 safe-bottom z-20 mb-4 mx-2 rounded-2xl shadow-lg border md:border-t md:border-x-0 md:border-b-0 md:mb-0 md:mx-0 md:rounded-none md:shadow-none">
Â  Â  Â  Â  Â  Â  <form id="chat-form" class="max-w-4xl mx-auto relative flex items-center">
Â  Â  Â  Â  Â  Â  Â  Â  <input 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  type="text" 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  id="user-input" 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  placeholder="Describe your symptoms..." 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  autocomplete="off"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  class="w-full bg-slate-100 text-slate-800 placeholder-slate-400 border-0 rounded-2xl py-4 pl-5 pr-14 focus:ring-2 focus:ring-blue-500 focus:bg-white transition-all shadow-inner outline-none text-base"
Â  Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  <button 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  type="submit" 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  id="send-btn"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  disabled
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  class="absolute right-2 p-2 rounded-xl transition-all duration-200 bg-slate-200 text-slate-400 cursor-not-allowed flex items-center justify-center"
Â  Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i data-lucide="send" class="w-5 h-5"></i>
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  </form>
Â  Â  Â  Â  Â  Â  <p class="text-center text-[10px] text-slate-400 mt-3 hidden md:block">
Â  Â  Â  Â  Â  Â  Â  Â  Empath AI is an AI and can make mistakes. Always verify with a human professional.
Â  Â  Â  Â  Â  Â  </p>
Â  Â  Â  Â  </div>
Â  Â  </main>

Â  Â  <script>
Â  Â  Â  Â  // --- Configuration ---
Â  Â  Â  Â  // IMPORTANT: API Key is left blank. The execution environment will securely inject it.
Â  Â  Â  Â  const API_KEY = ""; 
Â  Â  Â  Â  const MODEL_NAME = 'gemini-2.5-flash-preview-09-2025';
Â  Â  Â  Â  
Â  Â  Â  Â  // Corrected the system prompt to use proper newlines (\n) for better instruction parsing
Â  Â  Â  Â  const SYSTEM_PROMPT = "You are Empath AI designed by Nithin Chatla & Nithish a highly experienced Primary Care Physician, Psychiatrist, and Psychologist.\nYour job is to act like a real doctor: calm, empathetic, non-judgemental, medically accurate, and extremely careful.\nYour Abilities\nDiagnose possible conditions based on symptoms\nProvide safe medical advice following global standards\nExplain medicines, dosage, side effects\nProvide mental health support like a psychologist\nProvide psychiatric guidance\nAssess risk levels (mild / moderate / severe)\nAsk follow-up questions like a real doctor\nProvide daily habits, exercises, diet, lifestyle corrections\nProvide emergency instructions\nHelp with common medical issues (fever, cold, infection, wounds, digestion, skin issues, sexual health, etc.)\nSafety Rules (VERY IMPORTANT)\nYou must:\nNever give harmful, illegal, or dangerous suggestions\nAlways recommend a doctor visit for serious conditions\nAvoid prescribing prescription medicines unless user already has them\nProvide emotional support for mental health queries\nKeep responses short, clear, empathetic, and medically correct\nIf user mentions suicide, panic, trauma, self-harm, switch to crisis support mode\nPersonality\nWarm\nHuman-like\nPatient\nSupportive\nSpeaks in simple language\nAdds emotional understanding\nAlways explains the â€œwhyâ€\nSounds like a real doctor talking to the patient\nðŸŽ¯ RESPONSE FORMAT\nAlways follow this structure:\nEmpathy Message\nUnderstanding of the problem\nAsk 4â€“6 follow-up questions (very important)\nGive possible causes\nGive step-by-step solution / treatment\nWhat to avoid\nWhen to see a doctor urgently\nEncouragement message\nðŸ’¬ EXAMPLE STARTER BEHAVIOR\nIf the user says: I Have Chest pain\nDoctor should respond:\nShow concern\nAsk questions: location? duration? sharp/dull? breathing? sweating? family history?\nGive possible causes: muscle strain, anxiety, GERD, heart issue\nGive safe home care\nGive red-flag symptoms requiring hospital visit\nGive reassurance\nThis website is a Indian website and used by Indians. The Website Owner is Nithin Chatla";

Â  Â  Â  Â  // --- State ---
Â  Â  Â  Â  let chatHistory = [
Â  Â  Â  Â  Â  Â  { 
Â  Â  Â  Â  Â  Â  Â  Â  text: "Hello, Iâ€™m your AI Health Companion ðŸ¤ðŸ’™ðŸŒ¿\nIâ€™m here to support you with any medical questions ðŸ©º, mental-health concerns ðŸ§ ðŸ’­, emotional struggles ðŸ˜”ðŸ’”, stress ðŸ˜£, depression ðŸŒ§ï¸, anxiety ðŸ˜Ÿ, or other health problems.\nYou can talk to me safely â€” I listen without judgment ðŸ¤—âœ¨\nHereâ€™s how I can support you:\nðŸ’¬ Emotional & mental support\nðŸŒˆ Tips for stress, anxiety & depression\nðŸ©º Understanding symptoms clearly\nðŸ’¡ General medical information\nâ¤ï¸ Steps to feel better and stay healthy\nðŸ‘¨â€âš•ï¸ Guidance on when to see a real doctor\nIf youâ€™re feeling lonely, low, scared, or overwhelmed â€” youâ€™re not alone ðŸ’›ðŸ¤\nIâ€™m here with you, every step of the way ðŸ’«ðŸŒŸ\nHow can I support you today? ðŸ˜Š", 
Â  Â  Â  Â  Â  Â  Â  Â  sender: 'bot', 
Â  Â  Â  Â  Â  Â  Â  Â  time: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }) 
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  ];
Â  Â  Â  Â  let isTyping = false;

Â  Â  Â  Â  // --- DOM Elements ---
Â  Â  Â  Â  const chatMessages = document.getElementById('chat-messages');
Â  Â  Â  Â  const chatForm = document.getElementById('chat-form');
Â  Â  Â  Â  const userInput = document.getElementById('user-input');
Â  Â  Â  Â  const sendBtn = document.getElementById('send-btn');
Â  Â  Â  Â  const sidebar = document.getElementById('sidebar');
Â  Â  Â  Â  const sidebarOverlay = document.getElementById('sidebar-overlay');
Â  Â  Â  Â  const openSidebarBtn = document.getElementById('open-sidebar');
Â  Â  Â  Â  const closeSidebarBtn = document.getElementById('close-sidebar');

Â  Â  Â  Â  // --- Initialization ---
Â  Â  Â  Â  document.addEventListener('DOMContentLoaded', () => {
Â  Â  Â  Â  Â  Â  lucide.createIcons();
Â  Â  Â  Â  Â  Â  renderMessages();
Â  Â  Â  Â  Â  Â  setupEventListeners();
Â  Â  Â  Â  });

Â  Â  Â  Â  // --- UI Functions ---

Â  Â  Â  Â  function setupEventListeners() {
Â  Â  Â  Â  Â  Â  // Input handling
Â  Â  Â  Â  Â  Â  userInput.addEventListener('input', () => {
Â  Â  Â  Â  Â  Â  Â  Â  if (userInput.value.trim() !== '' && !isTyping) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  sendBtn.disabled = false;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  sendBtn.classList.remove('bg-slate-200', 'text-slate-400', 'cursor-not-allowed');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  sendBtn.classList.add('bg-blue-600', 'text-white', 'shadow-md', 'hover:bg-blue-700', 'hover:scale-105', 'active:scale-95');
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  sendBtn.disabled = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  sendBtn.classList.add('bg-slate-200', 'text-slate-400', 'cursor-not-allowed');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  sendBtn.classList.remove('bg-blue-600', 'text-white', 'shadow-md', 'hover:bg-blue-700', 'hover:scale-105', 'active:scale-95');
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  // Form Submission
Â  Â  Â  Â  Â  Â  chatForm.addEventListener('submit', handleSend);

Â  Â  Â  Â  Â  Â  // Sidebar Toggles
Â  Â  Â  Â  Â  Â  openSidebarBtn.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  Â  Â  sidebar.classList.remove('-translate-x-full');
Â  Â  Â  Â  Â  Â  Â  Â  sidebarOverlay.classList.remove('hidden');
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  closeSidebarBtn.addEventListener('click', closeSidebar);
Â  Â  Â  Â  Â  Â  sidebarOverlay.addEventListener('click', closeSidebar);
Â  Â  Â  Â  }

Â  Â  Â  Â  function closeSidebar() {
Â  Â  Â  Â  Â  Â  sidebar.classList.add('-translate-x-full');
Â  Â  Â  Â  Â  Â  sidebarOverlay.classList.add('hidden');
Â  Â  Â  Â  }

Â  Â  Â  Â  function renderMessages() {
Â  Â  Â  Â  Â  Â  // Re-render the time stamp divider only
Â  Â  Â  Â  Â  Â  chatMessages.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex justify-center mb-8">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="bg-slate-200/60 text-slate-500 text-xs py-1 px-3 rounded-full">Today</span>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  // Render each message
Â  Â  Â  Â  Â  Â  chatHistory.forEach(msg => {
Â  Â  Â  Â  Â  Â  Â  Â  const isBot = msg.sender === 'bot';
Â  Â  Â  Â  Â  Â  Â  Â  const div = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  div.className = `flex w-full ${isBot ? 'justify-start' : 'justify-end'} mb-4 animate-fade-in-up`;
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  div.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="max-w-[85%] md:max-w-[70%] rounded-2xl px-4 py-3 shadow-sm ${
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  isBot 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ? 'bg-white text-slate-800 rounded-tl-none border border-slate-200' 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  : 'bg-blue-600 text-white rounded-tr-none'
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm md:text-base leading-relaxed whitespace-pre-wrap break-words">${msg.text}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-xs mt-1 block ${isBot ? 'text-slate-400' : 'text-blue-100 opacity-70'}">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${msg.time}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  chatMessages.appendChild(div);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  scrollToBottom();
Â  Â  Â  Â  }

Â  Â  Â  Â  function showTypingIndicator() {
Â  Â  Â  Â  Â  Â  const div = document.createElement('div');
Â  Â  Â  Â  Â  Â  div.id = 'typing-indicator';
Â  Â  Â  Â  Â  Â  div.className = 'flex justify-start mb-4 animate-fade-in-up';
Â  Â  Â  Â  Â  Â  div.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  <div class="bg-white border border-slate-200 rounded-2xl rounded-tl-none px-4 py-4 shadow-sm flex items-center space-x-1">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="w-2 h-2 bg-blue-400 rounded-full animate-bounce-dot" style="animation-delay: 0ms"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="w-2 h-2 bg-blue-400 rounded-full animate-bounce-dot" style="animation-delay: 150ms"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="w-2 h-2 bg-blue-400 rounded-full animate-bounce-dot" style="animation-delay: 300ms"></div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  chatMessages.appendChild(div);
Â  Â  Â  Â  Â  Â  scrollToBottom();
Â  Â  Â  Â  }

Â  Â  Â  Â  function removeTypingIndicator() {
Â  Â  Â  Â  Â  Â  const indicator = document.getElementById('typing-indicator');
Â  Â  Â  Â  Â  Â  if (indicator) indicator.remove();
Â  Â  Â  Â  }

Â  Â  Â  Â  function scrollToBottom() {
Â  Â  Â  Â  Â  Â  chatMessages.scrollTop = chatMessages.scrollHeight;
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- Logic Functions ---

Â  Â  Â  Â  async function handleSend(e) {
Â  Â  Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  Â  Â  const text = userInput.value.trim();
Â  Â  Â  Â  Â  Â  if (!text || isTyping) return;

Â  Â  Â  Â  Â  Â  // 1. Add User Message
Â  Â  Â  Â  Â  Â  const userMsg = {
Â  Â  Â  Â  Â  Â  Â  Â  text: text,
Â  Â  Â  Â  Â  Â  Â  Â  sender: 'user',
Â  Â  Â  Â  Â  Â  Â  Â  time: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })
Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  chatHistory.push(userMsg);
Â  Â  Â  Â  Â  Â  renderMessages(); 
Â  Â  Â  Â  Â  Â  userInput.value = '';
Â  Â  Â  Â  Â  Â  sendBtn.disabled = true;
Â  Â  Â  Â  Â  Â  sendBtn.classList.add('bg-slate-200', 'text-slate-400', 'cursor-not-allowed');
Â  Â  Â  Â  Â  Â  sendBtn.classList.remove('bg-blue-600', 'text-white', 'shadow-md', 'hover:bg-blue-700', 'hover:scale-105', 'active:scale-95');
Â  Â  Â  Â  Â  Â  isTyping = true;
Â  Â  Â  Â  Â  Â  showTypingIndicator();

Â  Â  Â  Â  Â  Â  // 2. Safety Check (Local)
Â  Â  Â  Â  Â  Â  const lowerInput = text.toLowerCase();
Â  Â  Â  Â  Â  Â  const dangerKeywords = ['suicide', 'kill myself', 'want to die', 'heart attack', 'stroke', 'severe bleeding'];
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  if (dangerKeywords.some(kw => lowerInput.includes(kw))) {
Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  addBotMessage("EMERGENCY ALERT: If you are experiencing a life-threatening emergency (like heart attack, stroke, or severe injury) or thoughts of self-harm, please call 108 or your local emergency number IMMEDIATELY. Do not wait for an AI response. I am here to listen, but your safety is paramount.");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  isTyping = false; // Reset typing flag
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  removeTypingIndicator(); // Remove indicator
Â  Â  Â  Â  Â  Â  Â  Â  }, 1000);
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // 3. API Call
Â  Â  Â  Â  Â  Â  const responseText = await callGeminiAPI(text);
Â  Â  Â  Â  Â  Â  addBotMessage(responseText);
Â  Â  Â  Â  }

Â  Â  Â  Â  function addBotMessage(text) {
Â  Â  Â  Â  Â  Â  removeTypingIndicator();
Â  Â  Â  Â  Â  Â  isTyping = false;
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  // Re-enable send button if input field is not empty
Â  Â  Â  Â  Â  Â  if (userInput.value.trim() !== '') {
Â  Â  Â  Â  Â  Â  Â  Â  sendBtn.disabled = false;
Â  Â  Â  Â  Â  Â  Â  Â  sendBtn.classList.remove('bg-slate-200', 'text-slate-400', 'cursor-not-allowed');
Â  Â  Â  Â  Â  Â  Â  Â  sendBtn.classList.add('bg-blue-600', 'text-white', 'shadow-md', 'hover:bg-blue-700', 'hover:scale-105', 'active:scale-95');
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  const botMsg = {
Â  Â  Â  Â  Â  Â  Â  Â  text: text,
Â  Â  Â  Â  Â  Â  Â  Â  sender: 'bot',
Â  Â  Â  Â  Â  Â  Â  Â  time: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })
Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  chatHistory.push(botMsg);
Â  Â  Â  Â  Â  Â  renderMessages();
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- API Logic ---

Â  Â  Â  Â  async function callGeminiAPI(latestMessage) {
Â  Â  Â  Â  Â  Â  const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/${MODEL_NAME}:generateContent?key=${API_KEY}`;
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  // Prepare contents array from chat history (excluding local welcome message)
Â  Â  Â  Â  Â  Â  // Slice(1) skips the first locally-generated welcome message
Â  Â  Â  Â  Â  Â  const apiContents = chatHistory
Â  Â  Â  Â  Â  Â  Â  Â  .slice(1) 
Â  Â  Â  Â  Â  Â  Â  Â  .map(msg => ({
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  role: msg.sender === 'user' ? 'user' : 'model',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  parts: [{ text: msg.text }]
Â  Â  Â  Â  Â  Â  Â  Â  }));

Â  Â  Â  Â  Â  Â  // Prepare the full payload
Â  Â  Â  Â  Â  Â  const payload = {
Â  Â  Â  Â  Â  Â  Â  Â  contents: apiContents,
Â  Â  Â  Â  Â  Â  Â  Â  systemInstruction: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  parts: [{ text: SYSTEM_PROMPT }]
Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  config: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  temperature: 0.7, 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  maxOutputTokens: 2000 // Increased token limit for detailed responses
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  // API Call with Exponential Backoff
Â  Â  Â  Â  Â  Â  const MAX_RETRIES = 3;
Â  Â  Â  Â  Â  Â  for (let attempt = 0; attempt < MAX_RETRIES; attempt++) {
Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const response = await fetch(apiUrl, {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  method: 'POST',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  headers: { 'Content-Type': 'application/json' },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  body: JSON.stringify(payload)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (response.ok) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const data = await response.json();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let text = data.candidates?.[0]?.content?.parts?.[0]?.text;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return text || "I'm evaluating your input. Could you provide more details?";
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.warn(`API call failed with status: ${response.status}`);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  } catch (e) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error(`Attempt ${attempt + 1} failed (Network/Parse Error):`, e);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  // Wait for exponential backoff before next attempt
Â  Â  Â  Â  Â  Â  Â  Â  if (attempt < MAX_RETRIES - 1) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const delay = Math.pow(2, attempt) * 1000;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await new Promise(resolve => setTimeout(resolve, delay));
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  return "I apologize, but I cannot connect to the medical database right now. Please check your connection or try again later.";
Â  Â  Â  Â  }

Â  Â  </script>
</body>
</html>
